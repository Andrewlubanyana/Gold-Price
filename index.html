<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Gold Price (XAU/USD)</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #d1d4dc;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            padding: 20px;
            background-color: #1e1e1e;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2a2a2a;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            color: #d4af37; /* Gold */
        }

        .price-container {
            text-align: right;
        }

        #price-display {
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
        }

        #status-display {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        #chart-container {
            flex-grow: 1;
            width: 100%;
            position: relative;
        }

        .disclaimer {
            font-size: 11px;
            color: #555;
            padding: 5px;
            text-align: center;
            background-color: #1e1e1e;
        }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>GOLD / USD</h1>
            <div style="font-size: 12px; color: #888;">PAX Gold (Real-time Proxy)</div>
        </div>
        <div class="price-container">
            <div id="price-display">Loading...</div>
            <div id="status-display">Initializing connection...</div>
        </div>
    </header>

    <div id="chart-container"></div>
    
    <div class="disclaimer">
        Powered by Lightweight Charts™. Data Source: CryptoCompare (History) & Binance (Live).
    </div>

    <script>
        // --- CONFIGURATION ---
        // We use PAXG (Pax Gold) as a proxy because real Forex APIs are not free.
        const SYMBOL_HISTORY = 'PAXG'; 
        const SYMBOL_LIVE = 'paxgusdt'; 
        
        // --- CHART SETUP ---
        const container = document.getElementById('chart-container');
        const chart = LightweightCharts.createChart(container, {
            layout: {
                textColor: '#d1d4dc',
                background: { type: 'solid', color: '#121212' },
            },
            grid: {
                vertLines: { color: '#2B2B43' },
                horzLines: { color: '#2B2B43' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            rightPriceScale: {
                borderColor: '#2B2B43',
                scaleMargins: { top: 0.1, bottom: 0.1 },
            },
            timeScale: {
                borderColor: '#2B2B43',
                timeVisible: true,
                secondsVisible: false,
            },
        });

        // Responsive Resizing
        new ResizeObserver(entries => {
            if (entries.length === 0 || entries[0].target !== container) { return; }
            const newRect = entries[0].contentRect;
            chart.applyOptions({ height: newRect.height, width: newRect.width });
        }).observe(container);

        const candleSeries = chart.addCandlestickSeries({
            upColor: '#26a69a',
            downColor: '#ef5350',
            borderVisible: false,
            wickUpColor: '#26a69a',
            wickDownColor: '#ef5350',
        });

        const statusDisplay = document.getElementById('status-display');
        const priceDisplay = document.getElementById('price-display');
        let currentPrice = 0;

        // --- DATA FETCHING ---

        // 1. Fetch History from CryptoCompare (More reliable for browsers than Binance REST API)
        async function loadHistory() {
            statusDisplay.innerText = "Fetching historical data...";
            try {
                // Fetching last 1000 minutes of data for PAXG/USD
                const response = await fetch(`https://min-api.cryptocompare.com/data/v2/histominute?fsym=${SYMBOL_HISTORY}&tsym=USD&limit=2000`);
                const json = await response.json();

                if (json.Response === 'Success') {
                    const data = json.Data.Data.map(d => ({
                        time: d.time,
                        open: d.open,
                        high: d.high,
                        low: d.low,
                        close: d.close
                    }));

                    candleSeries.setData(data);
                    
                    // Update initial price
                    const lastCandle = data[data.length - 1];
                    updatePrice(lastCandle.close);
                    statusDisplay.innerText = "Connecting to Live Stream...";
                    startWebSocket();
                } else {
                    throw new Error(json.Message || "API Error");
                }
            } catch (err) {
                console.error("History Fetch Error:", err);
                statusDisplay.innerText = "History failed. Attempting live only...";
                statusDisplay.style.color = "orange";
                // Even if history fails, try to start the live stream
                startWebSocket(); 
            }
        }

        // 2. Real-time Updates via Binance WebSocket
        function startWebSocket() {
            // Using Binance WebSocket because it usually bypasses CORS issues
            const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${SYMBOL_LIVE}@kline_1m`);

            ws.onopen = () => {
                statusDisplay.innerText = "● Live Market Data";
                statusDisplay.style.color = "#4caf50";
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                const k = message.k;

                const candle = {
                    time: k.t / 1000,
                    open: parseFloat(k.o),
                    high: parseFloat(k.h),
                    low: parseFloat(k.l),
                    close: parseFloat(k.c),
                };

                candleSeries.update(candle);
                updatePrice(candle.close);
            };

            ws.onerror = (err) => {
                console.error("WebSocket Error:", err);
                statusDisplay.innerText = "Stream Error (Check Console)";
                statusDisplay.style.color = "red";
            };
        }

        function updatePrice(price) {
            // Color animation based on price movement
            const color = price > currentPrice ? '#26a69a' : (price < currentPrice ? '#ef5350' : '#ffffff');
            priceDisplay.style.color = color;
            priceDisplay.innerText = `$${price.toFixed(2)}`;
            document.title = `$${price.toFixed(2)} | Gold`;
            currentPrice = price;
            
            // Reset color after a brief moment
            setTimeout(() => { priceDisplay.style.color = '#ffffff'; }, 500);
        }

        // Start the app
        loadHistory();

    </script>
</body>
</html>
